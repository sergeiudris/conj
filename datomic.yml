version: "3.3"
services:

  datomic-pro:
    image: datomic-pro
    container_name: datomic-pro
    # volumes:
    #   - ./.data/transactor:/opt/datomic-pro
    build:
      context: ./datomic-pro
      dockerfile: ./Dockerfile
    # ports:
    #   - "4336:4336"
    #   - "4335:4335"
    #   - "4334:4334"
    #   - "9000:9000"
    # entrypoint: ./bin/transactor
    command: tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    # depends_on:
    #   - base

  datomic-free:
    image: datomic-free
    container_name: datomic-free
    # volumes:
    #   - ./.data/transactor:/opt/datomic-pro
    build:
      context: ./datomic-free
      dockerfile: ./Dockerfile
    # ports:
    #   - "4336:4336"
    #   - "4335:4335"
    #   - "4334:4334"
    #   - "9000:9000"
    # entrypoint: ./bin/transactor
    command: tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    # depends_on:
    #   - base


  datomicdb:
    image: datomic-pro
    # image: conj_datomicdb
    container_name: datomicdb
    volumes:
      - "./.data/datomicdb:/opt/datomic-pro/data"
    # build:
    #   context: ./datomic-pro
    #   dockerfile: ./Dockerfile
    ports:
      - "4336:4336"
      - "4335:4335"
      - "4334:4334"
      # - "9000:9000"
    # entrypoint: ./bin/transactor
    command: ./bin/transactor ./config/dev-transactor.properties
    # command: config/dev-transactor.properties
    # command: tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    depends_on:
      - datomic-pro

  # waiter:
  #   image: aanand/wait
  #   links:
  #     - datomic-pro
  #     - transactor:datomicdb 

  console:
    image: datomic-pro
    # image: conj_console
    container_name: console
    # volumes:
    #   - ./.data/datomic-pro:/opt/datomic-pro
    # build:
    #   context: ./datomic-pro
    #   dockerfile: ./Dockerfile
    ports:
      - "9000:9000"
    # entrypoint: ./bin/console -p 9000
    command: ./bin/console -p 9000 dev datomic:dev://datomicdb:4334
    # command: dev datomic:dev://datomicdb:4334
    # command: tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    depends_on:
      - datomic-pro
      - datomicdb
    links:
      - datomicdb 


  datomicdbfree:
    image: datomic-free
    # image: conj_datomicdb
    container_name: datomicdbfree
    volumes:
      - "./.data/datomicdbfree:/opt/datomic-free/data"
    # build:
    #   context: ./datomic-pro
    #   dockerfile: ./Dockerfile
    ports:
      - "4436:4336"
      - "4435:4335"
      - "4434:4334"
      # - "9000:9000"
    # entrypoint: ./bin/transactor
    command: ./bin/transactor ./config/free-transactor.properties
    # command: config/dev-transactor.properties
    # command: tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    depends_on:
      - datomic-free


  clj:
    image: clj
    container_name: clj
    volumes:
      - ./clj:/opt/code/app
    build:
      context: ./clj
      dockerfile: ./Dockerfile
    ports:
      - 35543:35543
      - 7888:7888
    command: tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    # depends_on:
    #   - base
    links:
      - datomicdb
      - datomicdbfree

  datomic-load:
    image: datomic-load
    container_name: datomic-load
    build:
      context: ./datomic-load
      dockerfile: ./Dockerfile
    command: sh mbrainz.sh ; tail -f /dev/null
    # command: bash c nrepl_clj
    # environment:
    #   - DISPLAY=10.0.75.1:0.0
    stdin_open: true
    tty: true
    depends_on:
      - datomicdb
      - datomicdbfree
    links:
      - datomicdb
      - datomicdbfree
